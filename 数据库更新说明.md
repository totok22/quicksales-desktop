# 数据库迁移说明

本文档记录数据库结构变更及迁移方法。

---

## 数据库位置

| 系统 | 路径 |
|------|------|
| Windows | `%APPDATA%\com.quicksales.app\quicksales.db` |
| macOS | `~/Library/Application Support/com.quicksales.app/quicksales.db` |
| Linux | `~/.local/share/com.quicksales.app/quicksales.db` |

---

## 迁移记录

### 2026-02-15: 导出设置字段

新增字段：
- `app_settings.auto_open_excel` - 导出后自动打开 Excel
- `app_settings.skip_save_dialog` - 跳过保存对话框

升级 SQL：
```sql
ALTER TABLE app_settings ADD COLUMN auto_open_excel INTEGER DEFAULT 0;
ALTER TABLE app_settings ADD COLUMN skip_save_dialog INTEGER DEFAULT 0;
```

### 2026-01-10: 文件命名格式

修复模板文件命名格式从 `订单_{orderNo}_{customer}` 改为 `{date}_{customerName}_{orderNumber}`。

升级 SQL：
```sql
UPDATE templates 
SET filename_pattern = '{date}_{customerName}_{orderNumber}',
    updated_at = datetime('now')
WHERE filename_pattern LIKE '%订单%' OR filename_pattern LIKE '%{orderNo}%';
```

---

## 重置数据库

如需完全重置，删除数据库文件后重启应用即可自动创建新库。

> ⚠️ 重置会丢失所有数据，请先备份。
